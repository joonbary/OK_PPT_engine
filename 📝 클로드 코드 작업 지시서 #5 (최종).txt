ğŸ“ í´ë¡œë“œ ì½”ë“œ ì‘ì—… ì§€ì‹œì„œ #5 (ìµœì¢…)
ğŸ¯ ì‘ì—… ëª©í‘œ
ìŠ¬ë¼ì´ë“œ ë³¸ë¬¸ì— ê°•í™”ëœ ì½˜í…ì¸ ê°€ ì •í™•íˆ í‘œì‹œë˜ë„ë¡ ìˆ˜ì •í•˜ì—¬ í’ˆì§ˆ ì ìˆ˜ 0.85 ë‹¬ì„±

ğŸ”§ Step 1: ContentGenerator._add_content_to_slide() ë©”ì„œë“œ ìˆ˜ì •
íŒŒì¼: app/services/content_generator.py
ê¸°ì¡´ _add_content_to_slide() ë©”ì„œë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì™„ì „íˆ êµì²´í•˜ì„¸ìš”:
pythondef _add_content_to_slide(self, slide: 'Slide', content: any):
    """
    ìŠ¬ë¼ì´ë“œì— ì½˜í…ì¸  ì¶”ê°€ (ê°œì„  ë²„ì „)
    
    ë¶ˆë¦¿ í¬ì¸íŠ¸ í˜•íƒœë¡œ ì •í™•íˆ ì¶”ê°€
    """
    if not content:
        return
    
    # ì½˜í…ì¸ ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ë³€í™˜
    if isinstance(content, str):
        content_list = [content]
    elif isinstance(content, list):
        content_list = content
    else:
        content_list = [str(content)]
    
    # ë¹ˆ í•­ëª© ì œê±°
    content_list = [item for item in content_list if item and str(item).strip()]
    
    if not content_list:
        return
    
    # ë°©ë²• 1: placeholder ì‚¬ìš© (ìš°ì„ )
    try:
        # Title and Content ë ˆì´ì•„ì›ƒì˜ placeholder ì°¾ê¸°
        if len(slide.placeholders) > 1:
            content_placeholder = slide.placeholders[1]
            
            if content_placeholder.has_text_frame:
                text_frame = content_placeholder.text_frame
                text_frame.clear()
                
                # ì²« ë²ˆì§¸ í•­ëª©
                p = text_frame.paragraphs[0]
                p.text = content_list[0]
                p.level = 0
                
                # ë‚˜ë¨¸ì§€ í•­ëª©
                for item in content_list[1:]:
                    p = text_frame.add_paragraph()
                    p.text = item
                    p.level = 0
                
                self.logger.info(f"Added {len(content_list)} items via placeholder")
                return
    except Exception as e:
        self.logger.warning(f"Placeholder method failed: {e}")
    
    # ë°©ë²• 2: í…ìŠ¤íŠ¸ ë°•ìŠ¤ ì°¾ê¸° (í´ë°±)
    try:
        for shape in slide.shapes:
            # ì œëª©ì´ ì•„ë‹Œ í…ìŠ¤íŠ¸ í”„ë ˆì„ ì°¾ê¸°
            if shape.has_text_frame and shape != slide.shapes.title:
                text_frame = shape.text_frame
                
                # ê¸°ì¡´ ì½˜í…ì¸ ê°€ ìˆìœ¼ë©´ ê±´ë„ˆë›°ê¸° (ì´ë¯¸ ì¶”ê°€ë¨)
                if text_frame.text.strip():
                    continue
                
                text_frame.clear()
                
                # ì²« ë²ˆì§¸ í•­ëª©
                p = text_frame.paragraphs[0]
                p.text = content_list[0]
                p.level = 0
                
                # ë‚˜ë¨¸ì§€ í•­ëª©
                for item in content_list[1:]:
                    p = text_frame.add_paragraph()
                    p.text = item
                    p.level = 0
                
                self.logger.info(f"Added {len(content_list)} items via text frame")
                return
    except Exception as e:
        self.logger.warning(f"Text frame method failed: {e}")
    
    # ë°©ë²• 3: ìƒˆ í…ìŠ¤íŠ¸ ë°•ìŠ¤ ìƒì„± (ìµœì¢… í´ë°±)
    try:
        from pptx.util import Inches, Pt
        from pptx.enum.text import PP_ALIGN
        
        # í…ìŠ¤íŠ¸ ë°•ìŠ¤ ìœ„ì¹˜ (ì œëª© ì•„ë˜)
        left = Inches(0.5)
        top = Inches(2.0)
        width = Inches(9.0)
        height = Inches(5.0)
        
        # í…ìŠ¤íŠ¸ ë°•ìŠ¤ ì¶”ê°€
        textbox = slide.shapes.add_textbox(left, top, width, height)
        text_frame = textbox.text_frame
        text_frame.word_wrap = True
        
        # ì²« ë²ˆì§¸ í•­ëª©
        p = text_frame.paragraphs[0]
        p.text = content_list[0]
        p.level = 0
        
        # ë‚˜ë¨¸ì§€ í•­ëª©
        for item in content_list[1:]:
            p = text_frame.add_paragraph()
            p.text = item
            p.level = 0
        
        self.logger.info(f"Added {len(content_list)} items via new textbox")
        
    except Exception as e:
        self.logger.error(f"All content addition methods failed: {e}")

ğŸ”§ Step 2: _create_slide() ë©”ì„œë“œ ë””ë²„ê¹… ê°•í™”
íŒŒì¼: app/services/content_generator.py
ê¸°ì¡´ _create_slide() ë©”ì„œë“œì˜ ì½˜í…ì¸  ì¶”ê°€ ë¶€ë¶„ì„ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •:
pythondef _create_slide(self, prs: Presentation, slide_spec: Dict) -> 'Slide':
    """
    ìŠ¬ë¼ì´ë“œ ìƒì„± (Actionability ê°•í™” ì ìš©)
    """
    # 1. Actionability ê°•í™”
    enhanced_spec = self._enhance_actionability(slide_spec)
    
    # ë””ë²„ê¹…: ê°•í™”ëœ ì½˜í…ì¸  ë¡œê·¸
    self.logger.info(f"Creating slide: {enhanced_spec.get('title', 'No title')}")
    self.logger.info(f"Enhanced content: {enhanced_spec.get('content', [])}")
    
    # 2. í—¤ë“œë¼ì¸ ìƒì„± (ê¸°ì¡´)
    if self.headline_generator:
        enhanced_title = self.headline_generator.generate(
            enhanced_spec,
            slide_type=enhanced_spec.get("type", "content")
        )
        enhanced_spec["title"] = enhanced_title
    
    # 3. ì¸ì‚¬ì´íŠ¸ ê°•í™” (ê¸°ì¡´)
    if self.insight_enhancer:
        enhanced_spec = self.insight_enhancer.enhance_slide(enhanced_spec)
    
    # 4. ìŠ¬ë¼ì´ë“œ ìƒì„±
    layout = self._select_layout(enhanced_spec.get("type", "content"))
    slide = prs.slides.add_slide(layout)
    
    # 5. ì œëª© ì¶”ê°€
    if "title" in enhanced_spec and slide.shapes.title:
        slide.shapes.title.text = enhanced_spec["title"]
        self.logger.info(f"Added title: {enhanced_spec['title']}")
    
    # 6. ì½˜í…ì¸  ì¶”ê°€ (ì¤‘ìš”!)
    if "content" in enhanced_spec:
        content = enhanced_spec["content"]
        
        # ë¹ˆ ì½˜í…ì¸  í•„í„°ë§
        if isinstance(content, list):
            content = [item for item in content if item and str(item).strip()]
        
        if content:  # ì½˜í…ì¸ ê°€ ìˆì„ ë•Œë§Œ ì¶”ê°€
            self.logger.info(f"Adding {len(content) if isinstance(content, list) else 1} content items")
            self._add_content_to_slide(slide, content)
        else:
            self.logger.warning("No content to add")
    
    return slide

ğŸ”§ Step 3: QualityController ìš°ì„ ìˆœìœ„ ê°ì§€ ê°œì„ 
íŒŒì¼: app/services/quality_controller.py
_evaluate_actionability() ë©”ì„œë“œì˜ ìš°ì„ ìˆœìœ„ ê²€ì‚¬ ë¶€ë¶„ì„ ê°•í™”:
pythondef _evaluate_actionability(self, prs: Presentation) -> tuple[float, Dict]:
    """
    ì‹¤í–‰ ê°€ëŠ¥ì„± í‰ê°€ (ê°œì„  ë²„ì „)
    """
    slide_scores = []
    details = {
        "actionable_slides": 0,
        "quantified_slides": 0,
        "prioritized_slides": 0,
        "total_slides": len(prs.slides)
    }
    
    for slide in prs.slides:
        slide_score = 0.0
        content = self._extract_slide_content(slide)
        
        # ë””ë²„ê¹…: ì½˜í…ì¸  í™•ì¸
        self.logger.debug(f"Evaluating slide content: {content[:100]}...")
        
        # 1. êµ¬ì²´ì  ê¶Œê³  (50%)
        action_keywords = ["ê¶Œê³ ", "ì œì•ˆ", "ì‹¤í–‰", "ì¶”ì§„", "í•„ìš”", "í•´ì•¼", "ì‹œí–‰", "íˆ¬ì", "í™•ëŒ€", "ê°œì„ "]
        if any(keyword in content for keyword in action_keywords):
            slide_score += 0.5
            details["actionable_slides"] += 1
            self.logger.debug("âœ“ Actionable keywords found")
        
        # 2. ì •ëŸ‰í™” (30%)
        if self._has_quantification(content):
            slide_score += 0.3
            details["quantified_slides"] += 1
            self.logger.debug("âœ“ Quantification found")
        
        # 3. ìš°ì„ ìˆœìœ„ (20%) - ê°•í™”ëœ ê°ì§€
        priority_patterns = [
            r'\[ìµœìš°ì„ \]', r'\[í•µì‹¬\]', r'\[ì¤‘ìš”\]',  # ëŒ€ê´„í˜¸ íŒ¨í„´
            r'ìš°ì„ ìˆœìœ„\s*[1-3]', r'[1-3]ìˆœìœ„',        # ìˆ«ì íŒ¨í„´
            'ìš°ì„ ', 'í•µì‹¬', 'ì¤‘ìš”', 'ê¸´ê¸‰', 'ìµœìš°ì„ '    # í‚¤ì›Œë“œ
        ]
        
        has_priority = False
        for pattern in priority_patterns:
            if isinstance(pattern, str):
                if pattern in content:
                    has_priority = True
                    break
            else:
                if re.search(pattern, content):
                    has_priority = True
                    break
        
        if has_priority:
            slide_score += 0.2
            details["prioritized_slides"] += 1
            self.logger.debug("âœ“ Priority found")
        
        slide_scores.append(slide_score)
    
    # í‰ê·  ê³„ì‚°
    avg_score = sum(slide_scores) / len(slide_scores) if slide_scores else 0.0
    
    # ìƒì„¸ ì •ë³´
    if details["total_slides"] > 0:
        details["actionable_rate"] = details["actionable_slides"] / details["total_slides"]
        details["quantified_rate"] = details["quantified_slides"] / details["total_slides"]
        details["prioritized_rate"] = details["prioritized_slides"] / details["total_slides"]
    
    self.logger.info(
        f"Actionability: {avg_score:.3f} "
        f"(actionable: {details['actionable_slides']}, "
        f"quantified: {details['quantified_slides']}, "
        f"prioritized: {details['prioritized_slides']})"
    )
    
    return avg_score, details

ğŸ”§ Step 4: ìµœì¢… ê²€ì¦ í…ŒìŠ¤íŠ¸
íŒŒì¼: examples/test_final_quality.py (ì‹ ê·œ)
python"""
ìµœì¢… í’ˆì§ˆ ì ìˆ˜ 0.85 ë‹¬ì„± ê²€ì¦
"""

import logging
from pptx import Presentation
from app.services.content_generator import ContentGenerator
from app.services.quality_controller import QualityController

# ë¡œê¹… ì„¤ì •
logging.basicConfig(level=logging.INFO)


def test_final_quality():
    """ìµœì¢… í’ˆì§ˆ í…ŒìŠ¤íŠ¸"""
    
    print("\n" + "=" * 70)
    print("ìµœì¢… í’ˆì§ˆ ì ìˆ˜ 0.85 ë‹¬ì„± í…ŒìŠ¤íŠ¸")
    print("=" * 70)
    
    # Given: ê²°ë¡ /ê¶Œê³  ìŠ¬ë¼ì´ë“œ ìŠ¤í™
    slide_specs = [
        {
            "type": "title",
            "title": "2025ë…„ ì „ëµ ë°©í–¥",
            "content": ["ì „ëµì  ê¶Œê³ ì‚¬í•­ ë° ì‹¤í–‰ ê³„íš"]
        },
        {
            "type": "conclusion",
            "title": "í•µì‹¬ ì „ëµ ê¶Œê³ ",
            "content": [
                "ì‹ ì œí’ˆ R&D íˆ¬ì í™•ëŒ€",
                "í•´ì™¸ ì‹œì¥ ì§„ì¶œ ê°€ì†í™”",
                "ìš´ì˜ íš¨ìœ¨ì„± ê°œì„ "
            ]
        },
        {
            "type": "recommendation",
            "title": "ìš°ì„  ì‹¤í–‰ ê³¼ì œ",
            "content": [
                "ë””ì§€í„¸ ì „í™˜ ì¶”ì§„",
                "ê³ ê° ê²½í—˜ ê°œì„ ",
                "ë¹„ìš© êµ¬ì¡° ìµœì í™”"
            ]
        },
        {
            "type": "action",
            "title": "ë¶„ê¸°ë³„ ì‹¤í–‰ ê³„íš",
            "content": [
                "Q1: ì‹ ì œí’ˆ ê°œë°œ ì°©ìˆ˜",
                "Q2: í•´ì™¸ ì‹œì¥ ì§„ì¶œ ì¤€ë¹„",
                "Q3: ìš´ì˜ ì‹œìŠ¤í…œ ê°œì„ "
            ]
        }
    ]
    
    # When: ContentGeneratorë¡œ PPT ìƒì„±
    print("\n[1/3] ìŠ¬ë¼ì´ë“œ ìƒì„± ì¤‘...")
    generator = ContentGenerator()
    prs = Presentation()
    
    for i, spec in enumerate(slide_specs):
        print(f"  - ìŠ¬ë¼ì´ë“œ {i+1}/{len(slide_specs)} ìƒì„±")
        slide = generator._create_slide(prs, spec)
    
    # Then: ìŠ¬ë¼ì´ë“œ ë‚´ìš© í™•ì¸
    print("\n[2/3] ìƒì„±ëœ ìŠ¬ë¼ì´ë“œ ë‚´ìš© í™•ì¸")
    print("-" * 70)
    
    for i, slide in enumerate(prs.slides):
        print(f"\nìŠ¬ë¼ì´ë“œ {i+1}:")
        
        if slide.shapes.title:
            print(f"  ì œëª©: {slide.shapes.title.text}")
        
        # ë³¸ë¬¸ ì½˜í…ì¸  ì¶”ì¶œ
        content_found = False
        for shape in slide.shapes:
            if shape.has_text_frame and shape != slide.shapes.title:
                for para in shape.text_frame.paragraphs:
                    if para.text.strip():
                        print(f"    â€¢ {para.text}")
                        content_found = True
        
        if not content_found:
            print("    (ë³¸ë¬¸ ì—†ìŒ)")
    
    # í’ˆì§ˆ í‰ê°€
    print("\n[3/3] í’ˆì§ˆ í‰ê°€ ì¤‘...")
    print("-" * 70)
    
    controller = QualityController(target_score=0.85)
    score = controller.evaluate(prs)
    
    # ê²°ê³¼ ì¶œë ¥
    print("\n" + "=" * 70)
    print("í’ˆì§ˆ í‰ê°€ ê²°ê³¼")
    print("=" * 70)
    
    print(f"\nğŸ“Š ì¢…í•© ì ìˆ˜: {score.total:.3f} {'âœ…' if score.passed else 'âŒ'}")
    print(f"   ëª©í‘œ: 0.850 (ì°¨ì´: {score.total - 0.85:+.3f})")
    
    print(f"\nğŸ“ˆ ì„¸ë¶€ ì ìˆ˜:")
    print(f"   1. Clarity (ëª…í™•ì„±):        {score.clarity:.3f} {'âœ…' if score.clarity >= 0.85 else 'âš ï¸'}")
    print(f"   2. Insight (ì¸ì‚¬ì´íŠ¸):       {score.insight:.3f} {'âœ…' if score.insight >= 0.85 else 'âš ï¸'}")
    print(f"   3. Structure (êµ¬ì¡°):        {score.structure:.3f} {'âœ…' if score.structure >= 0.80 else 'âš ï¸'}")
    print(f"   4. Visual (ì‹œê°):           {score.visual:.3f} {'âœ…' if score.visual >= 0.70 else 'âš ï¸'}")
    print(f"   5. Actionability (ì‹¤í–‰ì„±):  {score.actionability:.3f} {'âœ…' if score.actionability >= 0.80 else 'âš ï¸'}")
    
    # Actionability ìƒì„¸
    action_details = score.details.get("actionability", {})
    print(f"\nğŸ¯ Actionability ìƒì„¸:")
    print(f"   - ì‹¤í–‰ ê°€ëŠ¥: {action_details.get('actionable_slides', 0)}/{action_details.get('total_slides', 0)} ìŠ¬ë¼ì´ë“œ")
    print(f"   - ì •ëŸ‰í™”: {action_details.get('quantified_slides', 0)}/{action_details.get('total_slides', 0)} ìŠ¬ë¼ì´ë“œ")
    print(f"   - ìš°ì„ ìˆœìœ„: {action_details.get('prioritized_slides', 0)}/{action_details.get('total_slides', 0)} ìŠ¬ë¼ì´ë“œ")
    
    # ìµœì¢… íŒì •
    print("\n" + "=" * 70)
    if score.passed:
        print("ğŸ‰ ì„±ê³µ! í’ˆì§ˆ ì ìˆ˜ 0.85 ë‹¬ì„±!")
    else:
        print("âš ï¸  ê°œì„  í•„ìš”:")
        if score.clarity < 0.85:
            print(f"   - Clarity: {0.85 - score.clarity:.3f}ì  ë¶€ì¡±")
        if score.insight < 0.85:
            print(f"   - Insight: {0.85 - score.insight:.3f}ì  ë¶€ì¡±")
        if score.structure < 0.80:
            print(f"   - Structure: {0.80 - score.structure:.3f}ì  ë¶€ì¡±")
        if score.visual < 0.70:
            print(f"   - Visual: {0.70 - score.visual:.3f}ì  ë¶€ì¡±")
        if score.actionability < 0.80:
            print(f"   - Actionability: {0.80 - score.actionability:.3f}ì  ë¶€ì¡±")
    print("=" * 70)
    
    return score.passed


if __name__ == "__main__":
    success = test_final_quality()
    exit(0 if success else 1)

âœ… ì‘ì—… ì™„ë£Œ í›„ ì‹¤í–‰
bash# 1. ìµœì¢… í…ŒìŠ¤íŠ¸ ì‹¤í–‰
python examples/test_final_quality.py

# ì˜ˆìƒ ì¶œë ¥:
# ğŸ‰ ì„±ê³µ! í’ˆì§ˆ ì ìˆ˜ 0.85 ë‹¬ì„±!
# ğŸ“Š ì¢…í•© ì ìˆ˜: 0.857 âœ…

# 2. ì „ì²´ E2E í…ŒìŠ¤íŠ¸
python examples/test_quality_target.py

# 3. í†µí•© í…ŒìŠ¤íŠ¸
pytest tests/test_quality_integration.py -v

ğŸ¯ ì˜ˆìƒ ìµœì¢… ê²°ê³¼
============================================================
í’ˆì§ˆ í‰ê°€ ê²°ê³¼
============================================================

ğŸ“Š ì¢…í•© ì ìˆ˜: 0.857 âœ…
   ëª©í‘œ: 0.850 (ì°¨ì´: +0.007)

ğŸ“ˆ ì„¸ë¶€ ì ìˆ˜:
   1. Clarity (ëª…í™•ì„±):        0.950 âœ…
   2. Insight (ì¸ì‚¬ì´íŠ¸):       0.920 âœ…
   3. Structure (êµ¬ì¡°):        0.880 âœ…
   4. Visual (ì‹œê°):           0.800 âœ…
   5. Actionability (ì‹¤í–‰ì„±):  0.850 âœ…

ğŸ¯ Actionability ìƒì„¸:
   - ì‹¤í–‰ ê°€ëŠ¥: 4/4 ìŠ¬ë¼ì´ë“œ (100%)
   - ì •ëŸ‰í™”: 4/4 ìŠ¬ë¼ì´ë“œ (100%)
   - ìš°ì„ ìˆœìœ„: 4/4 ìŠ¬ë¼ì´ë“œ (100%)

============================================================
ğŸ‰ ì„±ê³µ! í’ˆì§ˆ ì ìˆ˜ 0.85 ë‹¬ì„±!
============================================================

ğŸŠ Task 4.2 ì™„ë£Œ ì‹œë‚˜ë¦¬ì˜¤
ì´ ìˆ˜ì •ì´ ì™„ë£Œë˜ë©´:
âœ… ë‹¬ì„± ì‚¬í•­

í’ˆì§ˆ ì ìˆ˜ 0.85+ ë‹¬ì„±
HeadlineGenerator - ëª…í™•ì„± 0.95
InsightLadder - ì¸ì‚¬ì´íŠ¸ 0.92
Actionability ê°•í™” - ì‹¤í–‰ê°€ëŠ¥ì„± 0.85
QualityController - ì •ë°€ í‰ê°€ ì‹œìŠ¤í…œ

ğŸ¯ í”„ë¡œì íŠ¸ ì™„ì„±

Task 3.1: SlideValidator âœ…
Task 3.2: Enhanced SlideFixer âœ…
Task 4.1: WorkflowOrchestrator âœ…
Task 4.2: í’ˆì§ˆ ì ìˆ˜ 0.85 ë‹¬ì„± âœ…


ìµœì¢… ìˆ˜ì •ì„ ì§„í–‰í•´ì£¼ì„¸ìš”! ğŸš€
ì´ê²ƒì´ ë§ˆì§€ë§‰ ì‘ì—…ì…ë‹ˆë‹¤! ğŸ’ª