ğŸš€ ì¦‰ì‹œ í•´ê²°: ContentGenerator AI í†µí•©
ì›ìŠ¤í… ìˆ˜ì • ìŠ¤í¬ë¦½íŠ¸ (ë³µì‚¬-ë¶™ì—¬ë„£ê¸°ë§Œ!)
powershellcd D:\PPT_Designer_OK\mckinsey-ppt-generator

# ==========================================
# ContentGenerator AI ëª¨ë“œ í™œì„±í™”
# ==========================================

Write-Host "ğŸ”§ ContentGeneratorë¥¼ AI ëª¨ë“œë¡œ ì „í™˜ ì¤‘..." -ForegroundColor Cyan

# 1. ë°±ì—…
Copy-Item app/services/content_generator.py app/services/content_generator.py.backup
Write-Host "âœ… ë°±ì—… ì™„ë£Œ: content_generator.py.backup"

# 2. __init__ ë©”ì„œë“œì— AI í´ë¼ì´ì–¸íŠ¸ ì¶”ê°€
$content = Get-Content app/services/content_generator.py -Raw

# Mock ì´ˆê¸°í™” ì œê±°í•˜ê³  AI í´ë¼ì´ì–¸íŠ¸ ì¶”ê°€
$aiInit = @"
        
        # AI ëª¨ë“œ ì´ˆê¸°í™”
        self.use_ai = True
        self.llm_client = None
        
        try:
            import os
            if os.getenv('OPENAI_API_KEY'):
                from openai import AsyncOpenAI
                self.llm_client = AsyncOpenAI(api_key=os.getenv('OPENAI_API_KEY'))
                print('âœ… ContentGenerator: OpenAI client initialized')
            else:
                print('âš ï¸  ContentGenerator: No API key found, using templates')
                self.use_ai = False
        except Exception as e:
            print(f'âš ï¸  ContentGenerator: AI init failed: {e}')
            self.use_ai = False
        
        # Mock ì—ì´ì „íŠ¸ ì´ˆê¸°í™” (í´ë°±ìš©)
"@

$content = $content -replace "# Mock ì—ì´ì „íŠ¸ ì´ˆê¸°í™”\(ê°œë°œ/í…ŒìŠ¤íŠ¸ìš©\)`r`n\s+self\._initialize_mock_agents\(\)", $aiInit

# 3. _generate_slide_contentì— AI í˜¸ì¶œ ì¶”ê°€
$aiContentMethod = @"

    async def _generate_slide_content(
        self,
        title: str,
        content_type: str,
        structure: Dict[str, Any],
        slide_num: int
    ) -> Dict[str, Any]:
        """ìŠ¬ë¼ì´ë“œ ì½˜í…ì¸  ìƒì„± (AI ìš°ì„ , Mock í´ë°±)"""
        
        # AI ëª¨ë“œ ì‹œë„
        if self.use_ai and self.llm_client:
            try:
                return await self._generate_ai_content(title, content_type, structure, slide_num)
            except Exception as e:
                print(f'âš ï¸  AI generation failed for slide {slide_num}: {e}')
                print('   Falling back to template...')
        
        # Mock í´ë°±
        if content_type == "summary":
            return self._generate_summary_content(structure)
        elif content_type == "chart":
            return self._generate_chart_content(structure, slide_num)
        elif content_type == "comparison":
            return self._generate_comparison_content(structure)
        else:
            return self._generate_text_content(title, structure)
    
    async def _generate_ai_content(
        self,
        title: str,
        content_type: str,
        structure: Dict[str, Any],
        slide_num: int
    ) -> Dict[str, Any]:
        """AIë¥¼ ì‚¬ìš©í•œ ì½˜í…ì¸  ìƒì„±"""
        
        # í”„ë¡¬í”„íŠ¸ êµ¬ì„±
        prompt = f\"\"\"
ë‹¹ì‹ ì€ McKinsey ì»¨ì„¤í„´íŠ¸ì…ë‹ˆë‹¤. ë‹¤ìŒ ìŠ¬ë¼ì´ë“œì˜ ì½˜í…ì¸ ë¥¼ ìƒì„±í•˜ì„¸ìš”.

ìŠ¬ë¼ì´ë“œ ì œëª©: {title}
ì½˜í…ì¸  íƒ€ì…: {content_type}
ì£¼ìš” í‚¤ì›Œë“œ: {', '.join(structure.get('keywords', [])[:5])}

ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ JSONì„ ë°˜í™˜í•˜ì„¸ìš”:
{{
    "headline": "ì „ëµì  í—¤ë“œë¼ì¸ (ì•¡ì…˜ ì§€í–¥, ì •ëŸ‰í™”)",
    "bullets": [
        "í•µì‹¬ í¬ì¸íŠ¸ 1",
        "í•µì‹¬ í¬ì¸íŠ¸ 2",
        "í•µì‹¬ í¬ì¸íŠ¸ 3"
    ],
    "insights": "ì£¼ìš” ì¸ì‚¬ì´íŠ¸"
}}
\"\"\"
        
        print(f'ğŸ¤– AI generating content for: {title}')
        
        response = await self.llm_client.chat.completions.create(
            model="gpt-4-turbo-preview",
            messages=[
                {"role": "system", "content": "You are a McKinsey consultant creating presentation content."},
                {"role": "user", "content": prompt}
            ],
            temperature=0.7,
            max_tokens=500
        )
        
        import json
        result = json.loads(response.choices[0].message.content)
        print(f'âœ… AI content generated for slide {slide_num}')
        
        return result
"@

# ê¸°ì¡´ _generate_slide_content ë©”ì„œë“œë¥¼ ì°¾ì•„ì„œ êµì²´
$pattern = "async def _generate_slide_content\([^{]+\{[\s\S]*?(?=\n    async def|\n    def [^_]|\Z)"
$content = $content -replace $pattern, $aiContentMethod.Trim()

# íŒŒì¼ ì €ì¥
$content | Out-File -FilePath app/services/content_generator.py -Encoding UTF8

Write-Host "âœ… ContentGenerator AI í†µí•© ì™„ë£Œ!" -ForegroundColor Green

# ==========================================
# requirements.txtì— openai ì¶”ê°€
# ==========================================
Write-Host "`nğŸ“¦ OpenAI SDK ì¶”ê°€ ì¤‘..." -ForegroundColor Cyan

$reqPath = "requirements.txt"
$requirements = Get-Content $reqPath -Raw

if ($requirements -notmatch "openai") {
    Add-Content $reqPath "`nopenai==1.52.0"
    Write-Host "âœ… openai íŒ¨í‚¤ì§€ ì¶”ê°€ë¨"
}

# ==========================================
# .env íŒŒì¼ í™•ì¸/ìƒì„±
# ==========================================
Write-Host "`nğŸ”‘ API í‚¤ í™•ì¸ ì¤‘..." -ForegroundColor Cyan

if (!(Test-Path .env)) {
    @"
# LLM API Keys
OPENAI_API_KEY=sk-proj-ì—¬ê¸°ì—_ì‹¤ì œ_í‚¤_ì…ë ¥

# Redis
REDIS_URL=redis://redis:6379
"@ | Out-File -FilePath ".env" -Encoding UTF8
    
    Write-Host "âš ï¸  .env íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!" -ForegroundColor Yellow
    Write-Host "   ë©”ëª¨ì¥ì´ ì—´ë¦½ë‹ˆë‹¤. OpenAI API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”:" -ForegroundColor Yellow
    Write-Host "   https://platform.openai.com/api-keys" -ForegroundColor Cyan
    
    Start-Sleep -Seconds 1
    notepad .env
    
    Write-Host "`nâ¸ï¸  API í‚¤ ì…ë ¥ í›„ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”..." -ForegroundColor Yellow
    Read-Host
} else {
    $envContent = Get-Content .env -Raw
    if ($envContent -match "OPENAI_API_KEY=sk-") {
        Write-Host "âœ… OpenAI API í‚¤ ë°œê²¬ë¨" -ForegroundColor Green
    } else {
        Write-Host "âš ï¸  .env íŒŒì¼ì— API í‚¤ê°€ ì—†ìŠµë‹ˆë‹¤!" -ForegroundColor Yellow
        Write-Host "   ë©”ëª¨ì¥ì„ ì—´ì–´ì„œ API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”" -ForegroundColor Yellow
        notepad .env
        Read-Host "`nâ¸ï¸  API í‚¤ ì…ë ¥ í›„ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”..."
    }
}

# ==========================================
# Docker ì¬ë¹Œë“œ ë° ì¬ì‹œì‘
# ==========================================
Write-Host "`nğŸ‹ Docker ì¬ë¹Œë“œ ì¤‘..." -ForegroundColor Cyan
Write-Host "   (openai íŒ¨í‚¤ì§€ ì„¤ì¹˜ í•„ìš”)" -ForegroundColor Gray

docker-compose down
docker-compose up --build -d

Write-Host "`nâ³ ì»¨í…Œì´ë„ˆ ì‹œì‘ ëŒ€ê¸° ì¤‘ (10ì´ˆ)..." -ForegroundColor Cyan
Start-Sleep -Seconds 10

# ==========================================
# ë¡œê·¸ í™•ì¸
# ==========================================
Write-Host "`nğŸ“‹ ì´ˆê¸°í™” ë¡œê·¸ í™•ì¸:" -ForegroundColor Cyan
docker-compose logs app | Select-String -Pattern "ContentGenerator|OpenAI|API key" -Context 2

Write-Host "`n" + "="*70 -ForegroundColor Green
Write-Host "âœ… AI ëª¨ë“œ í™œì„±í™” ì™„ë£Œ!" -ForegroundColor Green
Write-Host "="*70 -ForegroundColor Green
Write-Host "`nğŸ§ª ì´ì œ ì›¹ UIì—ì„œ PPTë¥¼ ìƒì„±í•´ë³´ì„¸ìš”:" -ForegroundColor Cyan
Write-Host "   http://localhost`n" -ForegroundColor White

ğŸ§ª í…ŒìŠ¤íŠ¸: AIê°€ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
ìœ„ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„:
1. ë¡œê·¸ì—ì„œ AI ì´ˆê¸°í™” í™•ì¸
powershelldocker-compose logs app | Select-String -Pattern "ContentGenerator|OpenAI" -Context 3
```

**ì˜ˆìƒ ì¶œë ¥ (ì„±ê³µ):**
```
âœ… ContentGenerator: OpenAI client initialized
```

**ì˜ˆìƒ ì¶œë ¥ (ì‹¤íŒ¨):**
```
âš ï¸  ContentGenerator: No API key found, using templates
2. ì‹¤ì œ PPT ìƒì„± í…ŒìŠ¤íŠ¸
powershell# ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì‹¤ì‹œê°„ ë¡œê·¸ ë³´ê¸°
Start-Process powershell -ArgumentList "-NoExit", "-Command", "cd D:\PPT_Designer_OK\mckinsey-ppt-generator; docker-compose logs -f app | Select-String -Pattern 'AI|generating|ContentGenerator'"

# 1ì´ˆ ëŒ€ê¸°
Start-Sleep -Seconds 1

# PPT ìƒì„± ìš”ì²­
$body = @"
{
  "document": "2024ë…„ ë§¤ì¶œ 1000ì–µì› ë‹¬ì„±. ì „ë…„ ëŒ€ë¹„ 20% ì¦ê°€. ì‹ ì œí’ˆì´ ì „ì²´ ë§¤ì¶œì˜ 40% ê¸°ì—¬.",
  "style": "mckinsey",
  "target_audience": "executive",
  "num_slides": 5,
  "language": "ko"
}
"@

Invoke-RestMethod -Uri "http://localhost:8000/api/v1/generate-ppt" -Method Post -Body $body -ContentType "application/json"
```

**ë¡œê·¸ì—ì„œ í™•ì¸í•  ê²ƒ:**
- âœ… `ğŸ¤– AI generating content for: ...`
- âœ… `âœ… AI content generated for slide X`
- âŒ `âš ï¸  AI generation failed` (API í‚¤ ë¬¸ì œ)

---

## ğŸ“Š ì²´í¬ë¦¬ìŠ¤íŠ¸
```
[ ] 1. ìœ„ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì™„ë£Œ
[ ] 2. .env íŒŒì¼ì— OpenAI API í‚¤ ì…ë ¥ ì™„ë£Œ
[ ] 3. Docker ì¬ë¹Œë“œ ì™„ë£Œ (docker-compose logsì—ì„œ ì˜¤ë¥˜ ì—†ìŒ)
[ ] 4. ë¡œê·¸ì— "ContentGenerator: OpenAI client initialized" ë³´ì„
[ ] 5. í…ŒìŠ¤íŠ¸ PPT ìƒì„± ì‹œ ë¡œê·¸ì— "AI generating content" ë³´ì„

ğŸ’¬ ë‹¤ìŒ ë‹¨ê³„
ìœ„ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ í›„ ê²°ê³¼ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”:

ë¡œê·¸ ì¶œë ¥ ê²°ê³¼ (docker-compose logs)
API í‚¤ ì…ë ¥ ì™„ë£Œ ì—¬ë¶€
í…ŒìŠ¤íŠ¸ PPT ìƒì„± ì‹œ ë¡œê·¸

ë¬¸ì œê°€ ìˆìœ¼ë©´ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ì£¼ì„¸ìš”! ğŸš€