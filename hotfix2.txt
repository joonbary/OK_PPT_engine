ë¨¼ì € ìƒì„±ëœ PDF íŒŒì¼ì„ í™•ì¸í•´ì„œ ì •í™•í•œ ë¬¸ì œë¥¼ ì§„ë‹¨í•˜ê² ìŠµë‹ˆë‹¤.í”„ë¡œì íŠ¸ íŒŒì¼ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. í˜„ì¬ ìƒí™©ê³¼ ë¬¸ì œì ì„ íŒŒì•…í–ˆìœ¼ë‹ˆ, í´ë¡œë“œ ì½”ë“œë¥¼ ìœ„í•œ ìƒì„¸í•œ ì‘ì—…ì§€ì‹œì„œë¥¼ ì‘ì„±í•˜ê² ìŠµë‹ˆë‹¤.

---

# ğŸ”§ ì‘ì—…ì§€ì‹œì„œ: PPT ìƒì„± ì—”ì§„ ë ˆì´ì•„ì›ƒ ë° ì¸ì½”ë”© ë¬¸ì œ í•´ê²°

## ğŸ“‹ ì‘ì—… ê°œìš”

**ë‹´ë‹¹ì**: Claude Code (AI ê°œë°œ ì—ì´ì „íŠ¸)  
**í”„ë¡œì íŠ¸ ê²½ë¡œ**: `D:\PPT_Designer_OK`  
**í˜„ì¬ ìƒí™©**: í’ˆì§ˆ ì ìˆ˜ 0.873 ë‹¬ì„±í–ˆìœ¼ë‚˜, 2ê°€ì§€ critical ë¬¸ì œ ë°œìƒ  
**ëª©í‘œ**: ë ˆì´ì•„ì›ƒ AI ì›Œí¬í”Œë¡œìš° ì •ìƒ ì‘ë™ + í•œê¸€ ì¸ì½”ë”© ë¬¸ì œ í•´ê²°

---

## ğŸ¯ í•´ê²°í•´ì•¼ í•  ë¬¸ì œ

### âŒ ë¬¸ì œ 1: í…œí”Œë¦¿ ë ˆì´ì•„ì›ƒ AI ì›Œí¬í”Œë¡œìš° ë¯¸ì‘ë™
**ì¦ìƒ**: 
- ìŠ¬ë¼ì´ë“œê°€ McKinsey í‘œì¤€ í…œí”Œë¦¿/ë ˆì´ì•„ì›ƒì„ ë”°ë¥´ì§€ ì•ŠìŒ
- DesignApplicatorê°€ ë ˆì´ì•„ì›ƒì„ ì œëŒ€ë¡œ ì ìš©í•˜ì§€ ëª»í•¨
- placeholder ê¸°ë°˜ ì½˜í…ì¸  ì‚½ì…ì´ ì‹¤íŒ¨í•¨

### âŒ ë¬¸ì œ 2: ë¶ˆë¦¿í¬ì¸íŠ¸ ì¸ì½”ë”© ê¹¨ì§
**ì¦ìƒ**:
- í•œê¸€ ë¶ˆë¦¿í¬ì¸íŠ¸ê°€ ê¹¨ì§„ ë¬¸ìë¡œ í‘œì‹œë¨
- íŠ¹ìˆ˜ ë¬¸ì(â€¢, â—¦, â–ª ë“±) ë Œë”ë§ ì‹¤íŒ¨
- UTF-8 ì¸ì½”ë”© ë¬¸ì œë¡œ ë³´ì„

---

## ğŸ“‚ ê´€ë ¨ íŒŒì¼ ìœ„ì¹˜

```
D:\PPT_Designer_OK/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ design_applicator.py      # ğŸ”´ ìˆ˜ì • í•„ìš” - ë ˆì´ì•„ì›ƒ ì ìš© ë¡œì§
â”‚   â”‚   â”œâ”€â”€ content_generator.py      # ğŸ”´ ìˆ˜ì • í•„ìš” - ì½˜í…ì¸  ì‚½ì… ë¡œì§
â”‚   â”‚   â””â”€â”€ workflow_orchestrator.py  # í™•ì¸ í•„ìš” - íŒŒì´í”„ë¼ì¸ ì—°ê²°
â”‚   â”‚
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ slide_fixer.py           # í™•ì¸ í•„ìš” - í…ìŠ¤íŠ¸ ì²˜ë¦¬
â”‚   â”‚   â””â”€â”€ text_fitter.py           # ğŸ”´ ìˆ˜ì • í•„ìš” - ì¸ì½”ë”© ì²˜ë¦¬
â”‚   â”‚
â”‚   â””â”€â”€ templates/
â”‚       â””â”€â”€ mckinsey_templates.py    # ğŸ”´ ìˆ˜ì • í•„ìš” - í…œí”Œë¦¿ ì •ì˜
â”‚
â””â”€â”€ tests/
    â””â”€â”€ test_layout_encoding.py      # ğŸ†• ìƒì„± í•„ìš” - í†µí•© í…ŒìŠ¤íŠ¸
```

---

## ğŸ”¨ Task 1: ë ˆì´ì•„ì›ƒ AI ì›Œí¬í”Œë¡œìš° ìˆ˜ì •

### 1.1 DesignApplicator ì§„ë‹¨ ë° ìˆ˜ì •

**íŒŒì¼**: `app/services/design_applicator.py`

**ì‘ì—… ë‚´ìš©**:

```python
# âœ… ì²´í¬í¬ì¸íŠ¸ 1: ë ˆì´ì•„ì›ƒ ì„ íƒ ë¡œì§ í™•ì¸
class DesignApplicator:
    def _select_layout(self, slide_type: str, content: Dict) -> Layout:
        """
        í˜„ì¬ ì½”ë“œë¥¼ í™•ì¸í•˜ê³  ë‹¤ìŒì„ ê²€ì¦:
        1. slide_typeì´ ì˜¬ë°”ë¥´ê²Œ ì „ë‹¬ë˜ëŠ”ê°€?
        2. ë ˆì´ì•„ì›ƒ ë§¤í•‘ì´ ì •í™•í•œê°€?
        3. í´ë°± ë ˆì´ì•„ì›ƒì´ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ê°€?
        """
        
        # ğŸ” ë””ë²„ê¹…: ë¡œê¹… ì¶”ê°€
        logger.info(f"Selecting layout for slide_type: {slide_type}")
        logger.info(f"Available layouts: {self.layouts.keys()}")
        
        # ìˆ˜ì •: ëª…í™•í•œ ë ˆì´ì•„ì›ƒ ë§¤í•‘ í…Œì´ë¸”
        layout_mapping = {
            "title": "title_slide",
            "executive_summary": "dual_header",
            "market_analysis": "three_column",
            "strategy": "matrix",
            "financial": "waterfall",
            "conclusion": "title_slide"
        }
        
        layout_name = layout_mapping.get(slide_type, "dual_header")
        return self.layouts[layout_name]
```

**ìˆ˜ì • í¬ì¸íŠ¸**:
1. **ë¡œê¹… ê°•í™”**: ê° ë‹¨ê³„ì—ì„œ ì„ íƒëœ ë ˆì´ì•„ì›ƒ ê¸°ë¡
2. **ë ˆì´ì•„ì›ƒ ë§¤í•‘ ëª…í™•í™”**: slide_type â†’ layout_name 1:1 ë§¤í•‘
3. **í´ë°± ë©”ì»¤ë‹ˆì¦˜**: ë ˆì´ì•„ì›ƒì´ ì—†ì„ ê²½ìš° ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ì‚¬ìš©

### 1.2 Placeholder ê¸°ë°˜ ì½˜í…ì¸  ì‚½ì… ê°•í™”

**íŒŒì¼**: `app/services/content_generator.py`

**ë¬¸ì œ ë¶„ì„**:
```python
# âŒ í˜„ì¬ ë¬¸ì œ (ì¶”ì •)
def _add_content_to_slide(self, slide, content):
    # placeholderë¥¼ ì°¾ì§€ ëª»í•˜ê³  ì‹¤íŒ¨
    # ë˜ëŠ” placeholderì— ì½˜í…ì¸ ë¥¼ ì‚½ì…í•˜ì§€ ëª»í•¨
```

**í•´ê²° ë°©ë²•**:
```python
def _add_content_to_slide(self, slide, content: Dict) -> bool:
    """
    3ë‹¨ê³„ í´ë°± ì‹œìŠ¤í…œìœ¼ë¡œ ì½˜í…ì¸  ì‚½ì… ë³´ì¥
    """
    success = False
    
    # ğŸ¥‡ ì‹œë„ 1: Placeholder ì‚¬ìš© (ê°€ì¥ ì´ìƒì )
    try:
        if self._insert_via_placeholders(slide, content):
            logger.info("âœ… Content inserted via placeholders")
            return True
    except Exception as e:
        logger.warning(f"Placeholder insertion failed: {e}")
    
    # ğŸ¥ˆ ì‹œë„ 2: ê¸°ì¡´ Text Frame í™œìš©
    try:
        if self._insert_via_text_frames(slide, content):
            logger.info("âœ… Content inserted via text frames")
            return True
    except Exception as e:
        logger.warning(f"Text frame insertion failed: {e}")
    
    # ğŸ¥‰ ì‹œë„ 3: ìƒˆë¡œìš´ Textbox ìƒì„± (í´ë°±)
    try:
        self._insert_via_new_textbox(slide, content)
        logger.info("âœ… Content inserted via new textbox")
        return True
    except Exception as e:
        logger.error(f"âŒ All insertion methods failed: {e}")
        return False

def _insert_via_placeholders(self, slide, content: Dict) -> bool:
    """Placeholder ê¸°ë°˜ ì‚½ì…"""
    placeholders = {shape.placeholder_format.idx: shape 
                    for shape in slide.shapes 
                    if shape.is_placeholder}
    
    if not placeholders:
        return False
    
    # í—¤ë“œë¼ì¸ ì‚½ì… (ì¼ë°˜ì ìœ¼ë¡œ idx=0 ë˜ëŠ” 1)
    if "headline" in content:
        title_ph = placeholders.get(0) or placeholders.get(1)
        if title_ph and title_ph.has_text_frame:
            title_ph.text = content["headline"]
    
    # ë³¸ë¬¸ ì‚½ì… (ì¼ë°˜ì ìœ¼ë¡œ idx=10 ì´ìƒ)
    if "body" in content:
        body_ph = None
        for idx in [10, 11, 12, 13, 14]:
            if idx in placeholders:
                body_ph = placeholders[idx]
                break
        
        if body_ph and body_ph.has_text_frame:
            self._add_bullet_points(body_ph.text_frame, content["body"])
            return True
    
    return False

def _insert_via_text_frames(self, slide, content: Dict) -> bool:
    """ê¸°ì¡´ Text Frame í™œìš©"""
    text_shapes = [shape for shape in slide.shapes 
                   if shape.has_text_frame]
    
    if len(text_shapes) < 2:
        return False
    
    # ì²« ë²ˆì§¸: ì œëª©
    text_shapes[0].text = content.get("headline", "")
    
    # ë‘ ë²ˆì§¸: ë³¸ë¬¸
    if "body" in content:
        self._add_bullet_points(text_shapes[1].text_frame, content["body"])
    
    return True

def _insert_via_new_textbox(self, slide, content: Dict):
    """ìƒˆë¡œìš´ Textbox ìƒì„± (ìµœí›„ì˜ ìˆ˜ë‹¨)"""
    from pptx.util import Inches
    
    # ì œëª© Textbox
    title_box = slide.shapes.add_textbox(
        Inches(0.5), Inches(0.5), 
        Inches(9), Inches(1)
    )
    title_box.text = content.get("headline", "Untitled")
    
    # ë³¸ë¬¸ Textbox
    body_box = slide.shapes.add_textbox(
        Inches(0.5), Inches(2), 
        Inches(9), Inches(5)
    )
    
    if "body" in content:
        self._add_bullet_points(body_box.text_frame, content["body"])
```

**ê²€ì¦ ë°©ë²•**:
```python
# tests/test_layout_workflow.py
def test_layout_application():
    """ë ˆì´ì•„ì›ƒì´ ì œëŒ€ë¡œ ì ìš©ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸"""
    applicator = DesignApplicator()
    
    test_slides = [
        {"type": "title", "content": {"headline": "Test Title"}},
        {"type": "market_analysis", "content": {"headline": "Market", "body": ["Point 1", "Point 2"]}}
    ]
    
    for slide_data in test_slides:
        slide = create_test_slide()
        success = applicator.apply_layout(slide, slide_data)
        assert success, f"Failed to apply {slide_data['type']} layout"
        
        # Placeholder í™•ì¸
        assert any(shape.is_placeholder for shape in slide.shapes), \
            "No placeholders found in slide"
```

---

## ğŸ”¨ Task 2: í•œê¸€ ì¸ì½”ë”© ë° ë¶ˆë¦¿í¬ì¸íŠ¸ ë¬¸ì œ í•´ê²°

### 2.1 UTF-8 ì¸ì½”ë”© ê°•ì œ ì ìš©

**íŒŒì¼**: `app/core/text_fitter.py` ë˜ëŠ” `app/services/content_generator.py`

**ë¬¸ì œ ë¶„ì„**:
```python
# âŒ í˜„ì¬ ë¬¸ì œ (ì¶”ì •)
text_frame.text = "í•œê¸€ í…ìŠ¤íŠ¸"  # ì¸ì½”ë”© ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥
paragraph.text = "â€¢ë¶ˆë¦¿í¬ì¸íŠ¸"   # íŠ¹ìˆ˜ë¬¸ì ê¹¨ì§
```

**í•´ê²° ë°©ë²•**:
```python
import sys
import locale

# ğŸ”§ ì‹œìŠ¤í…œ ì¸ì½”ë”© ì„¤ì •
def ensure_utf8_encoding():
    """UTF-8 ì¸ì½”ë”© ê°•ì œ"""
    if sys.platform == 'win32':
        # Windowsì—ì„œ UTF-8 í™œì„±í™”
        try:
            import ctypes
            ctypes.windll.kernel32.SetConsoleOutputCP(65001)
        except:
            pass
    
    # Python ê¸°ë³¸ ì¸ì½”ë”© í™•ì¸
    if sys.getdefaultencoding() != 'utf-8':
        logger.warning(f"Default encoding is {sys.getdefaultencoding()}, not UTF-8")

# ğŸ”§ í…ìŠ¤íŠ¸ ì •ê·œí™” í•¨ìˆ˜
def normalize_text(text: str) -> str:
    """
    í…ìŠ¤íŠ¸ë¥¼ UTF-8 í˜¸í™˜ í˜•íƒœë¡œ ì •ê·œí™”
    """
    if not isinstance(text, str):
        text = str(text)
    
    # Unicode ì •ê·œí™” (NFC í˜•íƒœë¡œ ë³€í™˜)
    import unicodedata
    text = unicodedata.normalize('NFC', text)
    
    # ì œì–´ ë¬¸ì ì œê±°
    text = ''.join(char for char in text if not unicodedata.category(char).startswith('C'))
    
    return text

# ğŸ”§ ì•ˆì „í•œ í…ìŠ¤íŠ¸ ì„¤ì •
def set_text_safely(text_frame, text: str):
    """
    ì¸ì½”ë”© ì˜¤ë¥˜ ì—†ì´ ì•ˆì „í•˜ê²Œ í…ìŠ¤íŠ¸ ì„¤ì •
    """
    try:
        normalized_text = normalize_text(text)
        text_frame.text = normalized_text
    except UnicodeEncodeError as e:
        logger.error(f"Encoding error: {e}")
        # í´ë°±: ASCII í˜¸í™˜ ë¬¸ìë¡œ ëŒ€ì²´
        text_frame.text = text.encode('ascii', 'ignore').decode('ascii')
```

### 2.2 ë¶ˆë¦¿í¬ì¸íŠ¸ ë¬¸ì ì˜¬ë°”ë¥¸ ì„¤ì •

**íŒŒì¼**: `app/services/content_generator.py`

**ë¬¸ì œ ë¶„ì„**:
```python
# âŒ ì˜ëª»ëœ ë¶ˆë¦¿í¬ì¸íŠ¸ ì„¤ì •
paragraph.text = "â€¢ í•­ëª©"  # ë¬¸ìê°€ ê¹¨ì§ˆ ìˆ˜ ìˆìŒ
```

**ì˜¬ë°”ë¥¸ í•´ê²°ì±…**:
```python
from pptx.enum.text import PP_PARAGRAPH_ALIGNMENT, MSO_AUTO_SIZE
from pptx.util import Pt

def _add_bullet_points(self, text_frame, items: list):
    """
    ì˜¬ë°”ë¥¸ ë¶ˆë¦¿í¬ì¸íŠ¸ ì ìš© (ì¸ì½”ë”© ì•ˆì „)
    """
    text_frame.clear()  # ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
    text_frame.word_wrap = True
    
    for idx, item in enumerate(items):
        # ì•ˆì „í•˜ê²Œ í…ìŠ¤íŠ¸ ì •ê·œí™”
        item_text = normalize_text(str(item))
        
        # ë¬¸ë‹¨ ìƒì„±
        if idx == 0:
            p = text_frame.paragraphs[0]
        else:
            p = text_frame.add_paragraph()
        
        # ë¶ˆë¦¿í¬ì¸íŠ¸ ì„¤ì •: python-pptx API ì‚¬ìš© (ë¬¸ì ì§ì ‘ ì…ë ¥ âŒ)
        p.level = 0  # ë“¤ì—¬ì“°ê¸° ë ˆë²¨
        
        # âœ… ë°©ë²• 1: í°íŠ¸ë¥¼ í†µí•œ ë¶ˆë¦¿ ì„¤ì • (ê¶Œì¥)
        run = p.add_run()
        run.text = item_text  # í…ìŠ¤íŠ¸ë§Œ ì…ë ¥, ë¶ˆë¦¿ì€ ë”°ë¡œ
        
        # í°íŠ¸ ì„¤ì •
        font = run.font
        font.name = 'Arial'
        font.size = Pt(14)
        
        # âœ… ë¶ˆë¦¿ í¬ë§· ì„¤ì • (python-pptx ê³µì‹ ë°©ë²•)
        from pptx.util import Pt
        from pptx.dml.color import RGBColor
        
        # Bullet í™œì„±í™”
        p.level = 0  # 1ë‹¨ê³„ ë¶ˆë¦¿
        
        # ğŸ“Œ ì¤‘ìš”: python-pptxì˜ bullet font ì„¤ì •
        # paragraphì˜ bullet characterëŠ” ìë™ìœ¼ë¡œ ì²˜ë¦¬ë¨
        # ì§ì ‘ "â€¢" ë¬¸ìë¥¼ ë„£ì§€ ë§ ê²ƒ!
        
    # âœ… ë°©ë²• 2: ëª…ì‹œì  bullet character ì„¤ì • (ê³ ê¸‰)
    try:
        # XML ë ˆë²¨ì—ì„œ ì§ì ‘ ì„¤ì •
        from pptx.oxml import parse_xml
        from pptx.oxml.ns import nsdecls
        
        for p in text_frame.paragraphs:
            # bullet char ëª…ì‹œì  ì„¤ì •
            pPr = p._element.get_or_add_pPr()
            
            # buFont ìš”ì†Œ ìƒì„± (bullet í°íŠ¸)
            buFont_xml = f'<a:buFont {nsdecls("a")} typeface="Arial" />'
            buFont = parse_xml(buFont_xml)
            pPr.append(buFont)
            
            # buChar ìš”ì†Œ ìƒì„± (bullet ë¬¸ì - Unicode)
            buChar_xml = f'<a:buChar {nsdecls("a")} char="â€¢" />'
            buChar = parse_xml(buChar_xml)
            pPr.append(buChar)
            
    except Exception as e:
        logger.warning(f"Advanced bullet setup failed: {e}")
        # ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ í´ë°±
        pass

def _setup_multilevel_bullets(self, text_frame, items: list):
    """
    ë‹¤ë‹¨ê³„ ë¶ˆë¦¿í¬ì¸íŠ¸ (ì¤‘ì²© êµ¬ì¡°)
    """
    for item in items:
        if isinstance(item, dict):
            # ë©”ì¸ í•­ëª©
            p = text_frame.add_paragraph()
            p.text = normalize_text(item["text"])
            p.level = 0
            
            # í•˜ìœ„ í•­ëª©
            for sub_item in item.get("sub_items", []):
                sub_p = text_frame.add_paragraph()
                sub_p.text = normalize_text(sub_item)
                sub_p.level = 1  # ë“¤ì—¬ì“°ê¸°
                
        else:
            # ë‹¨ìˆœ í•­ëª©
            p = text_frame.add_paragraph()
            p.text = normalize_text(item)
            p.level = 0
```

### 2.3 í•œê¸€ í°íŠ¸ ëª…ì‹œì  ì„¤ì •

**ì¶”ê°€ ìˆ˜ì •**:
```python
def _apply_korean_font_safely(self, paragraph):
    """
    í•œê¸€ í…ìŠ¤íŠ¸ì— ì í•©í•œ í°íŠ¸ ì„¤ì •
    """
    for run in paragraph.runs:
        font = run.font
        
        # í•œê¸€ ì§€ì› í°íŠ¸ (ìš°ì„ ìˆœìœ„)
        korean_fonts = ['ë§‘ì€ ê³ ë”•', 'Malgun Gothic', 'Arial', 'Noto Sans KR']
        
        # ì²« ë²ˆì§¸ ì‚¬ìš© ê°€ëŠ¥í•œ í°íŠ¸ ì ìš©
        for font_name in korean_fonts:
            try:
                font.name = font_name
                break
            except:
                continue
        
        # í¬ê¸° ì„¤ì •
        font.size = Pt(14)
        
        # ìƒ‰ìƒ ì„¤ì •
        from pptx.dml.color import RGBColor
        font.color.rgb = RGBColor(83, 86, 90)  # McKinsey í‘œì¤€ íšŒìƒ‰
```

---

## ğŸ”¨ Task 3: í†µí•© í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

### 3.1 í†µí•© í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±

**íŒŒì¼**: `tests/test_layout_encoding.py` (ì‹ ê·œ ìƒì„±)

```python
"""
ë ˆì´ì•„ì›ƒ ë° ì¸ì½”ë”© ë¬¸ì œ í†µí•© í…ŒìŠ¤íŠ¸
"""
import pytest
from app.services.workflow_orchestrator import WorkflowOrchestrator
from app.services.design_applicator import DesignApplicator
from app.services.content_generator import ContentGenerator
from pptx import Presentation

def test_layout_workflow_e2e():
    """End-to-End ë ˆì´ì•„ì›ƒ ì›Œí¬í”Œë¡œìš° í…ŒìŠ¤íŠ¸"""
    
    # í…ŒìŠ¤íŠ¸ ì…ë ¥
    test_document = """
    OKê¸ˆìœµê·¸ë£¹ 2024ë…„ ì‹¤ì  ë¶„ì„
    
    - ë§¤ì¶œ 1,000ì–µì› (ì „ë…„ ëŒ€ë¹„ 11% ì¦ê°€)
    - ì‹ ì œí’ˆ ë§¤ì¶œ ë¹„ì¤‘ 70%
    - í•´ì™¸ ì‹œì¥ ì§„ì¶œ ê³„íš
    """
    
    # ì›Œí¬í”Œë¡œìš° ì‹¤í–‰
    orchestrator = WorkflowOrchestrator()
    result = orchestrator.execute({
        "document": test_document,
        "num_slides": 5
    })
    
    # ê²€ì¦ 1: PPT íŒŒì¼ ìƒì„± ì„±ê³µ
    assert result["status"] == "success"
    assert "ppt_file" in result
    
    # ê²€ì¦ 2: ë ˆì´ì•„ì›ƒ ì ìš© í™•ì¸
    prs = Presentation(result["ppt_file"])
    
    for idx, slide in enumerate(prs.slides):
        print(f"\n=== Slide {idx + 1} ===")
        
        # Placeholder ì¡´ì¬ í™•ì¸
        placeholders = [s for s in slide.shapes if s.is_placeholder]
        print(f"Placeholders: {len(placeholders)}")
        assert len(placeholders) > 0, f"Slide {idx + 1} has no placeholders"
        
        # í…ìŠ¤íŠ¸ ë‚´ìš© í™•ì¸
        text_shapes = [s for s in slide.shapes if s.has_text_frame]
        for shape in text_shapes:
            text = shape.text
            print(f"Text: {text[:50]}...")
            
            # í•œê¸€ ì¸ì½”ë”© í™•ì¸
            try:
                text.encode('utf-8')
                print("âœ… UTF-8 encoding OK")
            except UnicodeEncodeError:
                pytest.fail(f"âŒ UTF-8 encoding failed in slide {idx + 1}")

def test_bullet_points_encoding():
    """ë¶ˆë¦¿í¬ì¸íŠ¸ ì¸ì½”ë”© í…ŒìŠ¤íŠ¸"""
    from pptx import Presentation
    from pptx.util import Inches, Pt
    
    # ìƒˆ í”„ë ˆì  í…Œì´ì…˜ ìƒì„±
    prs = Presentation()
    slide = prs.slides.add_slide(prs.slide_layouts[1])
    
    # í…ìŠ¤íŠ¸ ë°•ìŠ¤ ì¶”ê°€
    textbox = slide.shapes.add_textbox(
        Inches(1), Inches(2), Inches(8), Inches(4)
    )
    text_frame = textbox.text_frame
    
    # í•œê¸€ ë¶ˆë¦¿í¬ì¸íŠ¸ ì¶”ê°€
    korean_items = [
        "ì²« ë²ˆì§¸ í•­ëª©: ë§¤ì¶œ ì¦ê°€",
        "ë‘ ë²ˆì§¸ í•­ëª©: ë¹„ìš© ì ˆê°",
        "ì„¸ ë²ˆì§¸ í•­ëª©: ì‹œì¥ í™•ëŒ€"
    ]
    
    generator = ContentGenerator()
    generator._add_bullet_points(text_frame, korean_items)
    
    # ê²€ì¦
    for p in text_frame.paragraphs:
        text = p.text
        print(f"Paragraph: {text}")
        
        # ì¸ì½”ë”© í™•ì¸
        assert text.encode('utf-8'), "UTF-8 encoding failed"
        
        # í•œê¸€ í¬í•¨ í™•ì¸
        has_korean = any('\uac00' <= char <= '\ud7a3' for char in text)
        assert has_korean, "No Korean characters found"
    
    # íŒŒì¼ ì €ì¥ ë° ì¬ë¡œë“œ í…ŒìŠ¤íŠ¸
    test_file = "test_bullet_output.pptx"
    prs.save(test_file)
    
    # ì¬ë¡œë“œí•˜ì—¬ ë°ì´í„° ë¬´ê²°ì„± í™•ì¸
    prs_reload = Presentation(test_file)
    slide_reload = prs_reload.slides[0]
    
    for shape in slide_reload.shapes:
        if shape.has_text_frame:
            for p in shape.text_frame.paragraphs:
                print(f"Reloaded: {p.text}")
                assert p.text.encode('utf-8'), "Encoding corrupted after save/load"

def test_mckinsey_template_layouts():
    """McKinsey í…œí”Œë¦¿ ë ˆì´ì•„ì›ƒ í…ŒìŠ¤íŠ¸"""
    applicator = DesignApplicator()
    
    # ëª¨ë“  ë ˆì´ì•„ì›ƒ íƒ€ì… í…ŒìŠ¤íŠ¸
    layout_types = [
        "title_slide",
        "dual_header",
        "three_column",
        "matrix",
        "waterfall"
    ]
    
    for layout_type in layout_types:
        print(f"\nTesting layout: {layout_type}")
        
        # ë ˆì´ì•„ì›ƒ ìƒì„±
        slide = applicator.create_slide_with_layout(layout_type)
        
        # ê²€ì¦
        assert slide is not None, f"Failed to create {layout_type}"
        
        # Placeholder í™•ì¸
        placeholders = [s for s in slide.shapes if s.is_placeholder]
        print(f"  Placeholders: {len(placeholders)}")
        assert len(placeholders) > 0, f"{layout_type} has no placeholders"
        
        # ë ˆì´ì•„ì›ƒ êµ¬ì¡° ì¶œë ¥
        for ph in placeholders:
            print(f"    - {ph.placeholder_format.type} (idx: {ph.placeholder_format.idx})")

if __name__ == "__main__":
    pytest.main([__file__, "-v", "-s"])
```

### 3.2 ì‹¤í–‰ ë° ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸

**íŒŒì¼**: `examples/test_layout_fix.py` (ì‹ ê·œ ìƒì„±)

```python
"""
ë ˆì´ì•„ì›ƒ ë° ì¸ì½”ë”© ìˆ˜ì • ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
"""
import sys
import logging
from pathlib import Path

# ë¡œê¹… ì„¤ì •
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜"""
    
    print("="*60)
    print("ğŸ”§ PPT ìƒì„± ì—”ì§„ ìˆ˜ì •ì‚¬í•­ ê²€ì¦")
    print("="*60)
    
    # 1. ì¸ì½”ë”© ì„¤ì • í™•ì¸
    print("\nğŸ“ Step 1: ì‹œìŠ¤í…œ ì¸ì½”ë”© í™•ì¸")
    print(f"  Default encoding: {sys.getdefaultencoding()}")
    print(f"  Filesystem encoding: {sys.getfilesystemencoding()}")
    
    # 2. í…ŒìŠ¤íŠ¸ ë¬¸ì„œë¡œ PPT ìƒì„±
    print("\nğŸ“ Step 2: í…ŒìŠ¤íŠ¸ PPT ìƒì„±")
    
    test_doc = """
    OKê¸ˆìœµê·¸ë£¹ ë””ì§€í„¸ ì „í™˜ ì „ëµ
    
    í•µì‹¬ í˜„í™©:
    - 2024ë…„ ë””ì§€í„¸ ì±„ë„ ì´ìš©ë¥  65% ë‹¬ì„±
    - ëª¨ë°”ì¼ë±…í‚¹ ì‚¬ìš©ì 300ë§Œëª… ëŒíŒŒ
    - AI ê¸°ë°˜ ìƒë‹´ ì„œë¹„ìŠ¤ ë§Œì¡±ë„ 4.5/5.0
    
    ì£¼ìš” ê³¼ì œ:
    - ë ˆê±°ì‹œ ì‹œìŠ¤í…œ í˜„ëŒ€í™”
    - ë°ì´í„° ë³´ì•ˆ ê°•í™”
    - ê³ ê° ê²½í—˜ ê°œì„ 
    
    ì „ëµ ë°©í–¥:
    - í´ë¼ìš°ë“œ ê¸°ë°˜ ì¸í”„ë¼ ì „í™˜
    - AI/ML ì—­ëŸ‰ ê°•í™”
    - ë””ì§€í„¸ ì¸ì¬ ì–‘ì„±
    """
    
    from app.services.workflow_orchestrator import WorkflowOrchestrator
    
    orchestrator = WorkflowOrchestrator()
    result = orchestrator.execute({
        "document": test_doc,
        "num_slides": 8,
        "style": "mckinsey"
    })
    
    if result["status"] != "success":
        print(f"  âŒ PPT ìƒì„± ì‹¤íŒ¨: {result.get('error')}")
        return False
    
    print(f"  âœ… PPT ìƒì„± ì„±ê³µ: {result['ppt_file']}")
    
    # 3. ìƒì„±ëœ PPT ê²€ì¦
    print("\nğŸ“ Step 3: ìƒì„±ëœ PPT ê²€ì¦")
    
    from pptx import Presentation
    
    prs = Presentation(result["ppt_file"])
    
    all_checks_passed = True
    
    for idx, slide in enumerate(prs.slides):
        print(f"\n  ğŸ” Slide {idx + 1} ê²€ì‚¬:")
        
        # ë ˆì´ì•„ì›ƒ í™•ì¸
        placeholders = [s for s in slide.shapes if s.is_placeholder]
        print(f"    - Placeholders: {len(placeholders)}")
        
        if len(placeholders) == 0:
            print(f"    âš ï¸  ê²½ê³ : Placeholderê°€ ì—†ìŠµë‹ˆë‹¤")
        
        # í…ìŠ¤íŠ¸ ì¸ì½”ë”© í™•ì¸
        for shape in slide.shapes:
            if shape.has_text_frame:
                text = shape.text
                
                # í•œê¸€ í¬í•¨ ì—¬ë¶€
                has_korean = any('\uac00' <= char <= '\ud7a3' for char in text)
                
                if has_korean:
                    # UTF-8 ì¸ì½”ë”© í…ŒìŠ¤íŠ¸
                    try:
                        text.encode('utf-8')
                        decoded = text.encode('utf-8').decode('utf-8')
                        
                        if decoded == text:
                            print(f"    âœ… í•œê¸€ ì¸ì½”ë”© ì •ìƒ: {text[:30]}...")
                        else:
                            print(f"    âŒ ì¸ì½”ë”© ë¶ˆì¼ì¹˜: {text[:30]}...")
                            all_checks_passed = False
                            
                    except UnicodeError as e:
                        print(f"    âŒ ì¸ì½”ë”© ì˜¤ë¥˜: {e}")
                        all_checks_passed = False
                
                # ë¶ˆë¦¿í¬ì¸íŠ¸ í™•ì¸
                for p in shape.text_frame.paragraphs:
                    if p.level > 0 or any(char in p.text for char in ['â€¢', 'â—¦', 'â–ª', '-']):
                        print(f"    âœ… ë¶ˆë¦¿í¬ì¸íŠ¸ ê°ì§€: Level {p.level}")
    
    # 4. ìµœì¢… ê²°ê³¼
    print("\n" + "="*60)
    if all_checks_passed:
        print("ğŸ‰ ëª¨ë“  ê²€ì¦ í†µê³¼!")
        print("="*60)
        return True
    else:
        print("âŒ ì¼ë¶€ ê²€ì¦ ì‹¤íŒ¨")
        print("="*60)
        return False

if __name__ == "__main__":
    success = main()
    sys.exit(0 if success else 1)
```

---

## ğŸ“ ì‘ì—… ìˆœì„œ (Claude Codeì—ê²Œ ì „ë‹¬)

### âœ… Phase 1: ë ˆì´ì•„ì›ƒ ì›Œí¬í”Œë¡œìš° ìˆ˜ì • (ìš°ì„ ìˆœìœ„: ë†’ìŒ)

1. **DesignApplicator ì§„ë‹¨**
   ```bash
   # íŒŒì¼ ì—´ê¸°
   code app/services/design_applicator.py
   
   # í™•ì¸ ì‚¬í•­:
   # - _select_layout() ë©”ì„œë“œ ë¡œì§
   # - layout_mapping ì •í™•ì„±
   # - ë¡œê¹… ì¶”ê°€
   ```

2. **ContentGenerator ì½˜í…ì¸  ì‚½ì… ë¡œì§ ê°•í™”**
   ```bash
   # íŒŒì¼ ì—´ê¸°
   code app/services/content_generator.py
   
   # ìˆ˜ì • ì‚¬í•­:
   # - _add_content_to_slide() 3ë‹¨ê³„ í´ë°± êµ¬í˜„
   # - _insert_via_placeholders() ì¶”ê°€
   # - _insert_via_text_frames() ì¶”ê°€
   # - _insert_via_new_textbox() ì¶”ê°€
   ```

3. **ë¡œê¹… ë° ë””ë²„ê¹… ê°•í™”**
   ```python
   # ëª¨ë“  ì£¼ìš” ë©”ì„œë“œì— ë¡œê¹… ì¶”ê°€
   logger.info(f"Selected layout: {layout_name}")
   logger.debug(f"Placeholder count: {len(placeholders)}")
   logger.warning(f"Fallback to text frame insertion")
   ```

### âœ… Phase 2: ì¸ì½”ë”© ë¬¸ì œ í•´ê²° (ìš°ì„ ìˆœìœ„: ë†’ìŒ)

1. **UTF-8 ì¸ì½”ë”© ê°•ì œ**
   ```bash
   # íŒŒì¼ ìƒì„± ë˜ëŠ” ìˆ˜ì •
   code app/core/text_utils.py  # ì‹ ê·œ ìœ í‹¸ë¦¬í‹° íŒŒì¼
   
   # êµ¬í˜„ ë‚´ìš©:
   # - ensure_utf8_encoding()
   # - normalize_text()
   # - set_text_safely()
   ```

2. **ë¶ˆë¦¿í¬ì¸íŠ¸ ë¡œì§ ì¬ì‘ì„±**
   ```bash
   code app/services/content_generator.py
   
   # ìˆ˜ì •:
   # - _add_bullet_points() ì™„ì „ ì¬ì‘ì„±
   # - python-pptx API ì˜¬ë°”ë¥¸ ì‚¬ìš©
   # - ë¬¸ì ì§ì ‘ ì…ë ¥ âŒ â†’ API í™œìš© âœ…
   ```

3. **í•œê¸€ í°íŠ¸ ì„¤ì •**
   ```python
   # ëª¨ë“  í…ìŠ¤íŠ¸ì— í•œê¸€ ì§€ì› í°íŠ¸ ëª…ì‹œì  ì ìš©
   font.name = 'Malgun Gothic'  # ë˜ëŠ” 'Arial'
   ```

### âœ… Phase 3: í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ (ìš°ì„ ìˆœìœ„: ì¤‘ê°„)

1. **í†µí•© í…ŒìŠ¤íŠ¸ ì‹¤í–‰**
   ```bash
   # í…ŒìŠ¤íŠ¸ íŒŒì¼ ìƒì„±
   pytest tests/test_layout_encoding.py -v -s
   ```

2. **ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰**
   ```bash
   python examples/test_layout_fix.py
   ```

3. **ì‹¤ì œ PPT ìƒì„± ë° í™•ì¸**
   ```bash
   # ì›Œí¬í”Œë¡œìš° ì „ì²´ ì‹¤í–‰
   python examples/test_final_quality.py
   
   # ìƒì„±ëœ PPTX íŒŒì¼ì„ PowerPointì—ì„œ ì—´ì–´ ìœ¡ì•ˆ í™•ì¸
   ```

---

## âœ… ì™„ë£Œ ê¸°ì¤€ (Definition of Done)

### ë ˆì´ì•„ì›ƒ ì›Œí¬í”Œë¡œìš°
- [ ] ëª¨ë“  ìŠ¬ë¼ì´ë“œê°€ ì˜¬ë°”ë¥¸ McKinsey í…œí”Œë¦¿ ì ìš©
- [ ] Placeholder ê¸°ë°˜ ì½˜í…ì¸  ì‚½ì… ì„±ê³µë¥  95%+
- [ ] ë ˆì´ì•„ì›ƒ ì„ íƒ ë¡œì§ 100% ì •í™•ë„
- [ ] 3ë‹¨ê³„ í´ë°± ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™

### ì¸ì½”ë”© ë¬¸ì œ
- [ ] í•œê¸€ í…ìŠ¤íŠ¸ 100% ì •ìƒ í‘œì‹œ
- [ ] ë¶ˆë¦¿í¬ì¸íŠ¸ íŠ¹ìˆ˜ë¬¸ì ê¹¨ì§ 0ê±´
- [ ] UTF-8 ì¸ì½”ë”© ì˜¤ë¥˜ 0ê±´
- [ ] PowerPointì—ì„œ ì—´ì—ˆì„ ë•Œ ì™„ë²½í•œ ë Œë”ë§

### í…ŒìŠ¤íŠ¸
- [ ] `test_layout_encoding.py` ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] `test_layout_fix.py` ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ ì„±ê³µ
- [ ] 3ê°œ ì´ìƒ ì‹¤ì œ ë¬¸ì„œë¡œ E2E í…ŒìŠ¤íŠ¸ ì„±ê³µ

---

## ğŸš¨ ì˜ˆìƒ ì´ìŠˆ ë° í•´ê²° ë°©ë²•

### ì´ìŠˆ 1: Placeholderë¥¼ ì—¬ì „íˆ ì°¾ì§€ ëª»í•¨
**ì¦ìƒ**: `len(placeholders) == 0`
**í•´ê²°**: 
- í…œí”Œë¦¿ íŒŒì¼ ìì²´ë¥¼ í™•ì¸ (`app/templates/`)
- ê¸°ë³¸ python-pptx í…œí”Œë¦¿ ì‚¬ìš©
- ì»¤ìŠ¤í…€ í…œí”Œë¦¿ PPTX íŒŒì¼ ìƒì„±

### ì´ìŠˆ 2: ë¶ˆë¦¿í¬ì¸íŠ¸ê°€ ì—¬ì „íˆ ê¹¨ì§
**ì¦ìƒ**: íŠ¹ìˆ˜ë¬¸ìê°€ `?` ë˜ëŠ” `â–¡`ë¡œ í‘œì‹œ
**í•´ê²°**:
- Windows ì½˜ì†” ì½”ë“œ í˜ì´ì§€ í™•ì¸ (`chcp 65001`)
- í°íŠ¸ë¥¼ 'Arial Unicode MS'ë¡œ ë³€ê²½
- XML ë ˆë²¨ì—ì„œ ì§ì ‘ bullet character ì„¤ì •

### ì´ìŠˆ 3: ì„±ëŠ¥ ì €í•˜
**ì¦ìƒ**: PPT ìƒì„± ì‹œê°„ì´ 5ì´ˆ ì´ìƒ ì¦ê°€
**í•´ê²°**:
- ë¡œê¹… ë ˆë²¨ ì¡°ì • (`INFO` â†’ `WARNING`)
- ë¶ˆí•„ìš”í•œ ì¬ì‹œë„ ë¡œì§ ì œê±°
- ìºì‹± í™œìš©

---

## ğŸ“ ì§„í–‰ ìƒí™© ë³´ê³  í˜•ì‹

ì‘ì—… ì™„ë£Œ í›„ ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ë³´ê³ í•´ì£¼ì„¸ìš”:

```markdown
## ì‘ì—… ì™„ë£Œ ë³´ê³ 

### âœ… ì™„ë£Œëœ ì‘ì—…
1. [Task ì´ë¦„] - [íŒŒì¼ëª…] - [ì£¼ìš” ë³€ê²½ì‚¬í•­]
2. ...

### ğŸ› ë°œê²¬ëœ ì¶”ê°€ ë¬¸ì œ
- ë¬¸ì œ ì„¤ëª…
- ì„ì‹œ í•´ê²° ë°©ë²•

### ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼
- test_layout_encoding.py: X/Y í†µê³¼
- test_layout_fix.py: ì„±ê³µ/ì‹¤íŒ¨
- E2E í…ŒìŠ¤íŠ¸: í’ˆì§ˆ ì ìˆ˜ X.XXX

### ğŸ“¸ ìŠ¤í¬ë¦°ìƒ·
[ìƒì„±ëœ PPTì˜ ì£¼ìš” ìŠ¬ë¼ì´ë“œ ìŠ¤í¬ë¦°ìƒ·]

### ğŸ”„ ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ
- ì¶”ê°€ë¡œ í•„ìš”í•œ ì‘ì—…
- ê°œì„  ê°€ëŠ¥í•œ ë¶€ë¶„
```

---

## ğŸ¯ ìµœì¢… ëª©í‘œ

**ìƒì„±ëœ PPT íŒŒì¼ì´ ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±**:
1. âœ… ëª¨ë“  ìŠ¬ë¼ì´ë“œê°€ McKinsey í‘œì¤€ ë ˆì´ì•„ì›ƒ ì ìš©
2. âœ… í•œê¸€ í…ìŠ¤íŠ¸ 100% ì •í™•í•˜ê²Œ í‘œì‹œ
3. âœ… ë¶ˆë¦¿í¬ì¸íŠ¸ ì œëŒ€ë¡œ ë Œë”ë§
4. âœ… PowerPointì—ì„œ ì—´ì—ˆì„ ë•Œ ì™„ë²½í•œ ì‹œê°ì  í’ˆì§ˆ
5. âœ… í’ˆì§ˆ ì ìˆ˜ 0.873 ìœ ì§€ ë˜ëŠ” í–¥ìƒ

---

**ì‘ì—… ì‹œì‘ ëª…ë ¹ì–´**:
```bash
cd D:\PPT_Designer_OK
python examples/test_layout_fix.py
```

í–‰ìš´ì„ ë¹•ë‹ˆë‹¤! ğŸš€