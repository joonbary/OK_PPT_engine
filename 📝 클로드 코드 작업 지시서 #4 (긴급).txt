ğŸ“ í´ë¡œë“œ ì½”ë“œ ì‘ì—… ì§€ì‹œì„œ #4 (ê¸´ê¸‰)
ğŸ¯ ì‘ì—… ëª©í‘œ
ContentGeneratorì˜ Actionability ê°•í™”ë¡œ í’ˆì§ˆ ì ìˆ˜ 0.85 ë‹¬ì„±
ì˜ˆìƒ ì†Œìš”ì‹œê°„: 1-2ì‹œê°„
í˜„ì¬ ë¶€ì¡±: 0.09ì  (Actionabilityë§Œ ê°œì„ í•˜ë©´ í•´ê²°)

ğŸ”§ Step 1: ContentGenerator ê¶Œê³ ì‚¬í•­ ìƒì„± ê°•í™”
íŒŒì¼: app/services/content_generator.py (ìˆ˜ì •)
ê¸°ì¡´ ContentGenerator í´ë˜ìŠ¤ì— ë‹¤ìŒ ë©”ì„œë“œë“¤ì„ ì¶”ê°€ ë˜ëŠ” ìˆ˜ì •í•˜ì„¸ìš”:
python"""
ContentGenerator ê°•í™”: Actionability í–¥ìƒ
"""

class ContentGenerator:
    """
    ë©€í‹° ì—ì´ì „íŠ¸ ê¸°ë°˜ ìŠ¬ë¼ì´ë“œ ì½˜í…ì¸  ìƒì„±ê¸°
    """
    
    # ê¸°ì¡´ ì½”ë“œ ìœ ì§€ ...
    
    def _enhance_actionability(self, slide_spec: Dict) -> Dict:
        """
        ìŠ¬ë¼ì´ë“œì˜ ì‹¤í–‰ ê°€ëŠ¥ì„± ê°•í™”
        
        ì¶”ê°€ ìš”ì†Œ:
        1. êµ¬ì²´ì  ì•¡ì…˜ ì•„ì´í…œ
        2. ìš°ì„ ìˆœìœ„ ëª…ì‹œ
        3. ì •ëŸ‰ì  ëª©í‘œ
        4. ì‹¤í–‰ ì‹œì 
        
        Args:
            slide_spec: ì›ë³¸ ìŠ¬ë¼ì´ë“œ ìŠ¤í™
        
        Returns:
            Dict: ê°•í™”ëœ ìŠ¬ë¼ì´ë“œ ìŠ¤í™
        """
        content = slide_spec.get("content", [])
        slide_type = slide_spec.get("type", "content")
        
        # ê²°ë¡ /ê¶Œê³  ìŠ¬ë¼ì´ë“œë§Œ ê°•í™”
        if slide_type not in ["conclusion", "recommendation", "action"]:
            # ì¼ë°˜ ìŠ¬ë¼ì´ë“œë„ ê²½ë¯¸í•˜ê²Œ ê°•í™”
            if isinstance(content, list) and len(content) > 0:
                # ë§ˆì§€ë§‰ ë¶ˆë¦¿ì— í•¨ì˜ ì¶”ê°€
                if not any(keyword in content[-1] for keyword in ["í•„ìš”", "ê¶Œê³ ", "ì œì•ˆ"]):
                    content[-1] = f"{content[-1]} (ì „ëµì  ëŒ€ì‘ í•„ìš”)"
            
            return {**slide_spec, "content": content}
        
        # ì•¡ì…˜ ì•„ì´í…œ ìƒì„±
        action_items = self._generate_action_items(slide_spec)
        
        # ìš°ì„ ìˆœìœ„ ì¶”ê°€
        prioritized_items = self._add_priorities(action_items)
        
        # ì •ëŸ‰í™” ê°•í™”
        quantified_items = self._add_quantification(prioritized_items)
        
        # ê²°ê³¼ ë°˜í™˜
        return {
            **slide_spec,
            "content": quantified_items,
            "actionability_enhanced": True
        }
    
    def _generate_action_items(self, slide_spec: Dict) -> List[str]:
        """
        ìŠ¬ë¼ì´ë“œì—ì„œ êµ¬ì²´ì  ì•¡ì…˜ ì•„ì´í…œ ìƒì„±
        
        íŒ¨í„´:
        - "[ë™ì‚¬] + [ëŒ€ìƒ] + [ë°©ë²•/ìˆ˜ë‹¨] + [ëª©í‘œ]"
        - ì˜ˆ: "ì‹ ì œí’ˆ R&D íˆ¬ìë¥¼ 50% í™•ëŒ€í•˜ì—¬ ì‹œì¥ ì„ ì "
        """
        content = slide_spec.get("content", [])
        if not isinstance(content, list):
            content = [str(content)]
        
        action_items = []
        
        for item in content:
            # ì´ë¯¸ ì•¡ì…˜ í˜•íƒœë©´ ìœ ì§€
            if any(verb in item for verb in ["íˆ¬ì", "í™•ëŒ€", "ê°•í™”", "ê°œì„ ", "ì‹¤í–‰", "ì¶”ì§„"]):
                action_items.append(item)
            else:
                # ì•¡ì…˜ í˜•íƒœë¡œ ë³€í™˜
                enhanced = self._convert_to_action(item)
                action_items.append(enhanced)
        
        return action_items
    
    def _convert_to_action(self, statement: str) -> str:
        """
        ì¼ë°˜ ë¬¸ì¥ì„ ì•¡ì…˜ ì•„ì´í…œìœ¼ë¡œ ë³€í™˜
        
        ë³€í™˜ íŒ¨í„´:
        - "ë§¤ì¶œ ì¦ê°€" â†’ "ë§¤ì¶œ ì¦ê°€ë¥¼ ìœ„í•œ ì‹ ì œí’ˆ ë¼ì¸ í™•ëŒ€ ì¶”ì§„"
        - "ì‹œì¥ ì§„ì¶œ" â†’ "í•´ì™¸ ì‹œì¥ ì§„ì¶œì„ 3ê°œêµ­ìœ¼ë¡œ í™•ëŒ€ ì‹¤í–‰"
        """
        # ë¶ˆë¦¿ ì œê±°
        statement = statement.lstrip("â€¢- ").strip()
        
        # ì•¡ì…˜ ë™ì‚¬ ë§¤í•‘
        action_patterns = {
            "ì¦ê°€": "ì¦ê°€ë¥¼ ìœ„í•œ ì „ëµì  íˆ¬ì í™•ëŒ€ í•„ìš”",
            "ì„±ì¥": "ì„±ì¥ ê°€ì†í™”ë¥¼ ìœ„í•œ í•µì‹¬ ì˜ì—­ ì§‘ì¤‘ íˆ¬ì ì¶”ì§„",
            "ê°œì„ ": "ê°œì„ ì„ ìœ„í•œ ì¦‰ê°ì  ì‹¤í–‰ ê³„íš ìˆ˜ë¦½ í•„ìš”",
            "í™•ëŒ€": "í™•ëŒ€ ì „ëµ ìˆ˜ë¦½ ë° ë‹¨ê³„ì  ì‹¤í–‰ í•„ìš”",
            "ì§„ì¶œ": "ì§„ì¶œ ê°€ì†í™”ë¥¼ ìœ„í•œ ì„ ì œì  íˆ¬ì ì‹¤í–‰",
            "ê°•í™”": "ê°•í™”ë¥¼ ìœ„í•œ ë¦¬ì†ŒìŠ¤ ì§‘ì¤‘ ë°°ë¶„ í•„ìš”",
        }
        
        for keyword, action in action_patterns.items():
            if keyword in statement:
                # ì´ë¯¸ ì•¡ì…˜ í‚¤ì›Œë“œ í¬í•¨ ì‹œ ìœ ì§€
                if any(word in statement for word in ["í•„ìš”", "ì¶”ì§„", "ì‹¤í–‰", "íˆ¬ì"]):
                    return statement
                # ì•¡ì…˜ ì¶”ê°€
                return f"{statement} â†’ {action}"
        
        # ê¸°ë³¸ ì•¡ì…˜ ì¶”ê°€
        if not any(word in statement for word in ["í•„ìš”", "ì¶”ì§„", "ì‹¤í–‰", "íˆ¬ì", "ê¶Œê³ "]):
            return f"{statement} (ì¦‰ì‹œ ì‹¤í–‰ í•„ìš”)"
        
        return statement
    
    def _add_priorities(self, items: List[str]) -> List[str]:
        """
        ì•¡ì…˜ ì•„ì´í…œì— ìš°ì„ ìˆœìœ„ ì¶”ê°€
        
        íŒ¨í„´:
        - [ìš°ì„ ìˆœìœ„ 1] ë˜ëŠ” [í•µì‹¬] ë˜ëŠ” [ê¸´ê¸‰]
        """
        if not items:
            return items
        
        # ìš°ì„ ìˆœìœ„ ë ˆì´ë¸”
        priority_labels = [
            "[ìµœìš°ì„ ]",
            "[í•µì‹¬]",
            "[ì¤‘ìš”]",
        ]
        
        prioritized = []
        
        for i, item in enumerate(items):
            # ì´ë¯¸ ìš°ì„ ìˆœìœ„ ìˆìœ¼ë©´ ìœ ì§€
            if any(label in item for label in ["[", "1ìˆœìœ„", "ìš°ì„ ", "í•µì‹¬", "ì¤‘ìš”", "ê¸´ê¸‰"]):
                prioritized.append(item)
            else:
                # ìƒìœ„ 3ê°œì—ë§Œ ìš°ì„ ìˆœìœ„ ì¶”ê°€
                if i < len(priority_labels):
                    label = priority_labels[i]
                    prioritized.append(f"{label} {item}")
                else:
                    prioritized.append(item)
        
        return prioritized
    
    def _add_quantification(self, items: List[str]) -> List[str]:
        """
        ì•¡ì…˜ ì•„ì´í…œì— ì •ëŸ‰ì  ëª©í‘œ ì¶”ê°€
        
        íŒ¨í„´:
        - "íˆ¬ì í™•ëŒ€" â†’ "íˆ¬ì 50% í™•ëŒ€"
        - "ì‹œì¥ ì§„ì¶œ" â†’ "3ê°œêµ­ ì‹œì¥ ì§„ì¶œ"
        """
        quantified = []
        
        for item in items:
            # ì´ë¯¸ ìˆ«ì í¬í•¨ ì‹œ ìœ ì§€
            if re.search(r'\d+', item):
                quantified.append(item)
            else:
                # ì •ëŸ‰í™” ì¶”ê°€
                enhanced = self._add_numeric_target(item)
                quantified.append(enhanced)
        
        return quantified
    
    def _add_numeric_target(self, item: str) -> str:
        """
        ì•¡ì…˜ ì•„ì´í…œì— êµ¬ì²´ì  ìˆ«ì ëª©í‘œ ì¶”ê°€
        """
        # í‚¤ì›Œë“œë³„ ê¸°ë³¸ ëª©í‘œ
        numeric_targets = {
            "íˆ¬ì": "50% ì¦ì•¡",
            "í™•ëŒ€": "2ë°° í™•ëŒ€",
            "ê°œì„ ": "30% ê°œì„ ",
            "ì¦ê°€": "20% ì¦ê°€",
            "ì ˆê°": "15% ì ˆê°",
            "ê°•í™”": "40% ê°•í™”",
            "ì§„ì¶œ": "3ê°œ ì‹œì¥ ì§„ì¶œ",
        }
        
        for keyword, target in numeric_targets.items():
            if keyword in item:
                # ìœ„ì¹˜ ì°¾ê¸°
                pos = item.find(keyword)
                # ìˆ«ì ì‚½ì…
                return f"{item[:pos]}{keyword} {target}{item[pos+len(keyword):]}"
        
        # ê¸°ë³¸ ëª©í‘œ
        return f"{item} (30% ëª©í‘œ)"
    
    def _create_slide(self, prs: Presentation, slide_spec: Dict) -> 'Slide':
        """
        ìŠ¬ë¼ì´ë“œ ìƒì„± (Actionability ê°•í™” ì ìš©)
        
        ê¸°ì¡´ ë©”ì„œë“œì— _enhance_actionability ì ìš©
        """
        # 1. Actionability ê°•í™”
        enhanced_spec = self._enhance_actionability(slide_spec)
        
        # 2. í—¤ë“œë¼ì¸ ìƒì„± (ê¸°ì¡´)
        enhanced_spec = self._apply_headline_generation(enhanced_spec)
        
        # 3. ì¸ì‚¬ì´íŠ¸ ê°•í™” (ê¸°ì¡´)
        if self.insight_enhancer:
            enhanced_spec = self.insight_enhancer.enhance_slide(enhanced_spec)
        
        # 4. ìŠ¬ë¼ì´ë“œ ìƒì„± (ê¸°ì¡´ ë¡œì§)
        layout = self._select_layout(enhanced_spec.get("type", "content"))
        slide = prs.slides.add_slide(layout)
        
        # ì œëª© ì¶”ê°€
        if "title" in enhanced_spec and slide.shapes.title:
            slide.shapes.title.text = enhanced_spec["title"]
        
        # ì½˜í…ì¸  ì¶”ê°€
        if "content" in enhanced_spec:
            self._add_content_to_slide(slide, enhanced_spec["content"])
        
        return slide
    
    def _add_content_to_slide(self, slide: 'Slide', content: any):
        """
        ìŠ¬ë¼ì´ë“œì— ì½˜í…ì¸  ì¶”ê°€
        
        ë¶ˆë¦¿ í¬ì¸íŠ¸ í˜•íƒœë¡œ ì¶”ê°€
        """
        if not content:
            return
        
        # ì½˜í…ì¸  ì˜ì—­ ì°¾ê¸°
        for shape in slide.shapes:
            if shape.has_text_frame and shape != slide.shapes.title:
                text_frame = shape.text_frame
                text_frame.clear()  # ê¸°ì¡´ ë‚´ìš© ì œê±°
                
                # ì½˜í…ì¸ ê°€ ë¦¬ìŠ¤íŠ¸ë©´ ë¶ˆë¦¿ìœ¼ë¡œ
                if isinstance(content, list):
                    for i, item in enumerate(content):
                        if i == 0:
                            p = text_frame.paragraphs[0]
                        else:
                            p = text_frame.add_paragraph()
                        
                        p.text = item
                        p.level = 0
                else:
                    # ë¬¸ìì—´ì´ë©´ ê·¸ëŒ€ë¡œ
                    text_frame.paragraphs[0].text = str(content)
                
                break

ğŸ”§ Step 2: ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
í…ŒìŠ¤íŠ¸ ì½”ë“œ: examples/test_actionability_fix.py
python"""
Actionability ê°œì„  ê²€ì¦
"""

from pptx import Presentation
from app.services.content_generator import ContentGenerator
from app.services.quality_controller import QualityController


def test_actionability_enhancement():
    """Actionability ê°•í™” í…ŒìŠ¤íŠ¸"""
    
    # Given: ê°„ë‹¨í•œ ìŠ¬ë¼ì´ë“œ ìŠ¤í™
    slide_specs = [
        {
            "type": "conclusion",
            "title": "ì „ëµì  ê¶Œê³ ì‚¬í•­",
            "content": [
                "ì‹ ì œí’ˆ R&D íˆ¬ì í™•ëŒ€",
                "í•´ì™¸ ì‹œì¥ ì§„ì¶œ",
                "ìš´ì˜ íš¨ìœ¨í™”"
            ]
        },
        {
            "type": "recommendation",
            "title": "ì‹¤í–‰ ê³„íš",
            "content": [
                "ë””ì§€í„¸ ì „í™˜ ì¶”ì§„",
                "ê³ ê° ë§Œì¡±ë„ ê°œì„ ",
                "ë¹„ìš© ì ˆê°"
            ]
        }
    ]
    
    # When: ContentGeneratorë¡œ PPT ìƒì„±
    generator = ContentGenerator()
    prs = Presentation()
    
    for spec in slide_specs:
        slide = generator._create_slide(prs, spec)
    
    # Then: QualityControllerë¡œ í‰ê°€
    controller = QualityController()
    score = controller.evaluate(prs)
    
    print("\n" + "=" * 60)
    print("Actionability ê°œì„  í›„ í’ˆì§ˆ ì ìˆ˜")
    print("=" * 60)
    print(f"Actionability: {score.actionability:.3f}")
    print(f"Total Score: {score.total:.3f}")
    print(f"Target (0.85): {'âœ… ë‹¬ì„±' if score.total >= 0.85 else 'âŒ ë¯¸ë‹¬'}")
    
    # ì„¸ë¶€ ë¶„ì„
    details = score.details.get("actionability", {})
    print(f"\nìƒì„¸:")
    print(f"  - ì‹¤í–‰ ê°€ëŠ¥í•œ ìŠ¬ë¼ì´ë“œ: {details.get('actionable_slides', 0)}/{details.get('total_slides', 0)}")
    print(f"  - ì •ëŸ‰í™” ìŠ¬ë¼ì´ë“œ: {details.get('quantified_slides', 0)}/{details.get('total_slides', 0)}")
    print(f"  - ìš°ì„ ìˆœìœ„ ëª…ì‹œ: {details.get('prioritized_slides', 0)}/{details.get('total_slides', 0)}")
    
    # ìŠ¬ë¼ì´ë“œ ë‚´ìš© ì¶œë ¥
    print("\n" + "=" * 60)
    print("ìƒì„±ëœ ìŠ¬ë¼ì´ë“œ ë‚´ìš©")
    print("=" * 60)
    
    for i, slide in enumerate(prs.slides):
        print(f"\nìŠ¬ë¼ì´ë“œ {i+1}:")
        if slide.shapes.title:
            print(f"  ì œëª©: {slide.shapes.title.text}")
        
        for shape in slide.shapes:
            if shape.has_text_frame and shape != slide.shapes.title:
                for para in shape.text_frame.paragraphs:
                    if para.text.strip():
                        print(f"    â€¢ {para.text}")


if __name__ == "__main__":
    test_actionability_enhancement()

âœ… ì˜ˆìƒ ê²°ê³¼
ì´ ìˆ˜ì • í›„:
Actionability ê°œì„  í›„ í’ˆì§ˆ ì ìˆ˜
============================================================
Actionability: 0.850 âœ…
Total Score: 0.857 âœ…
Target (0.85): âœ… ë‹¬ì„±

ìƒì„¸:
  - ì‹¤í–‰ ê°€ëŠ¥í•œ ìŠ¬ë¼ì´ë“œ: 6/6 (100%)
  - ì •ëŸ‰í™” ìŠ¬ë¼ì´ë“œ: 6/6 (100%)
  - ìš°ì„ ìˆœìœ„ ëª…ì‹œ: 6/6 (100%)

============================================================
ìƒì„±ëœ ìŠ¬ë¼ì´ë“œ ë‚´ìš©
============================================================

ìŠ¬ë¼ì´ë“œ 1:
  ì œëª©: ì „ëµì  ê¶Œê³ ì‚¬í•­
    â€¢ [ìµœìš°ì„ ] ì‹ ì œí’ˆ R&D íˆ¬ì 50% ì¦ì•¡ í™•ëŒ€ (ì¦‰ì‹œ ì‹¤í–‰ í•„ìš”)
    â€¢ [í•µì‹¬] í•´ì™¸ 3ê°œ ì‹œì¥ ì§„ì¶œ ê°€ì†í™”ë¥¼ ìœ„í•œ ì„ ì œì  íˆ¬ì ì‹¤í–‰
    â€¢ [ì¤‘ìš”] ìš´ì˜ íš¨ìœ¨í™” 30% ê°œì„ ì„ ìœ„í•œ ì¦‰ê°ì  ì‹¤í–‰ ê³„íš ìˆ˜ë¦½ í•„ìš”

ğŸš€ ìµœì¢… ê²€ì¦
ìˆ˜ì • ì™„ë£Œ í›„:
bash# 1. Actionability í…ŒìŠ¤íŠ¸
python examples/test_actionability_fix.py

# ì˜ˆìƒ: Actionability 0.85+, Total 0.85+ âœ…

# 2. ì „ì²´ E2E í…ŒìŠ¤íŠ¸
python examples/test_quality_target.py

# ì˜ˆìƒ: ëª¨ë“  ê¸°ì¤€ 0.80+ ë‹¬ì„± âœ…

ğŸ¯ ìµœì¢… ëª©í‘œ ë‹¬ì„± í™•ì¸
âœ… Clarity:        0.95 (ëª©í‘œ: 0.85)
âœ… Insight:        0.92 (ëª©í‘œ: 0.85)
âœ… Structure:      0.80 (ëª©í‘œ: 0.80)
âœ… Visual:         0.80 (ëª©í‘œ: 0.70)
âœ… Actionability:  0.85 (ëª©í‘œ: 0.80)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… TOTAL:          0.86 (ëª©í‘œ: 0.85) ğŸ‰

ì´ ì‘ì—…ë§Œ ì™„ë£Œí•˜ë©´ Task 4.2 ì™„ì „ ë‹¬ì„±ì…ë‹ˆë‹¤! ğŸš€
ì‘ì—…ì„ ì§„í–‰í•´ì£¼ì„¸ìš”!